using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using Ecoplus.domain.core.Aggregats;
using Ecoplus.domain.core.Interfaces.Repository;
using Ecoplus.Infrastructure.Repository;
using Ecoplustest.Etats;

namespace Ecoplustest.Feuilles
{
    public partial class Exploitants : Form
    {
        IExploitantRepositories _exploitant = new ExploitantRepositories();
        public static int Id = 0;
        public static Exploitant monExploitant;

        public Exploitants()
        {
            InitializeComponent();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            var detailsExp=new Details_expl();
            detailsExp.ShowDialog();
            Rafraichir();
        }

        private void Exploitant_Load(object sender, EventArgs e)
        {
         Rafraichir();
        }

        private void button2_Click(object sender, EventArgs e)
        {

            var details = new Details_expl();
            if (dataGridView1.CurrentRow == null) return;
            Id = int.Parse(dataGridView1.CurrentRow.Cells[0].Value.ToString());

            var nom=!string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[1].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[1].Value.ToString():" ";
            var prenom=!string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[2].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[2].Value.ToString():" ";
            var district=!string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[3].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[3].Value.ToString():" ";
            var tel=!string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[4].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[4].Value.ToString():" ";
            var surface=(float)dataGridView1.CurrentRow.Cells[5].Value>=0
                ?(float)dataGridView1.CurrentRow.Cells[5].Value:0;
            var surfacetotal =(float) dataGridView1.CurrentRow.Cells[6].Value>=0
                ? (float)dataGridView1.CurrentRow.Cells[6].Value:0;
            var departement = !string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[7].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[7].Value.ToString():" ";
            
            var ville=!string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[8].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[8].Value.ToString():" ";
            var nature = !string.IsNullOrWhiteSpace(dataGridView1.CurrentRow.Cells[9].Value.ToString())
                ? dataGridView1.CurrentRow.Cells[9].Value.ToString() : " ";
            var iduser=0;
            

            monExploitant= new Exploitant(nom,prenom,district,tel,surface,surfacetotal,departement,
                ville,nature,iduser);
            details.ShowDialog();
            Rafraichir();
        }

        private void Rafraichir()
        {
            dataGridView1.Refresh();
            var result = _exploitant.ListeExploitant();


            dataGridView1.DataSource = result;
        }

        private void button4_Click(object sender, EventArgs e)
        {
            var monEtatform=new Etatform();
            monEtatform.ShowDialog();
            
        }

        private void button3_Click(object sender, EventArgs e)
        {
            if (dataGridView1.CurrentRow != null) Id =int.Parse( dataGridView1.CurrentRow.Cells[0].Value.ToString());

            if (MessageBox.Show(@"Confirmez vous la suppression?", @"Suppression", MessageBoxButtons.OKCancel,
                    MessageBoxIcon.Information) == DialogResult.Cancel) return;

            _exploitant.Supprimer(Id);

            Rafraichir();
        }
    }
}
